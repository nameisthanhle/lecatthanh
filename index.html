<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Infinite Plane Explorer</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black; /* black background */
    cursor: auto; /* cursor visible at start */
  }

  #intro-overlay {
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,0.95);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family: sans-serif;
    z-index: 999;
  }

  #start-button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 20px;
    cursor: pointer;
  }

  #crosshair {
    display: none; /* show after start */
    position: fixed;
    top: 50%;
    left: 50%;
    width: 10px;
    height: 10px;
    margin-left: -5px;
    margin-top: -5px;
    background: white;
    border-radius: 50%;
    z-index: 999;
    pointer-events: none;
  }
</style>
</head>
<body>

<div id="intro-overlay">
  <h1>Welcome to the Memory Plane</h1>
  <p>Explore the infinite world of your images.</p>
  <button id="start-button">Start</button>
</div>

<div id="crosshair"></div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.158/build/three.module.js';
import { PointerLockControls } from 'https://cdn.jsdelivr.net/npm/three@0.158/examples/jsm/controls/PointerLockControls.js';
import { TextureLoader } from 'https://cdn.jsdelivr.net/npm/three@0.158/build/three.module.js';

// ----- Scene -----
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

// ----- Camera -----
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,5,10);

// ----- Renderer -----
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ----- Lighting -----
const light = new THREE.AmbientLight(0xffffff, 1);
scene.add(light);

// ----- Infinite Plane -----
const planeGeometry = new THREE.PlaneGeometry(1000, 1000);
const planeMaterial = new THREE.MeshStandardMaterial({ color:0x111111, side: THREE.DoubleSide });
const plane = new THREE.Mesh(planeGeometry, planeMaterial);
plane.rotation.x = -Math.PI/2; // flat horizontal
scene.add(plane);

// ----- Images on plane (placeholder example) -----
const textureLoader = new TextureLoader();
const imageURLs = [
  'https://picsum.photos/200/200?random=1',
  'https://picsum.photos/200/200?random=2',
  'https://picsum.photos/200/200?random=3',
  'https://picsum.photos/200/200?random=4'
];
const images = [];
imageURLs.forEach(url=>{
  const tex = textureLoader.load(url);
  const mat = new THREE.MeshBasicMaterial({ map: tex, side: THREE.DoubleSide });
  const geom = new THREE.PlaneGeometry(3,3);
  const imgMesh = new THREE.Mesh(geom, mat);
  imgMesh.position.set(
    (Math.random()-0.5)*50,
    1.5,
    (Math.random()-0.5)*50
  );
  scene.add(imgMesh);
  images.push(imgMesh);
});

// ----- Controls -----
let controls;
const crosshair = document.getElementById('crosshair');
const introOverlay = document.getElementById('intro-overlay');
const startButton = document.getElementById('start-button');

startButton.addEventListener('click', ()=>{
  introOverlay.style.display = 'none';
  document.body.requestPointerLock();
  document.body.style.cursor = 'none';
  crosshair.style.display = 'block';
  
  controls = new PointerLockControls(camera, document.body);
});

// ----- Movement -----
const velocity = new THREE.Vector3();
const direction = new THREE.Vector3();
const keys = {};
document.addEventListener('keydown', e => keys[e.code] = true);
document.addEventListener('keyup', e => keys[e.code] = false);

function moveControls(delta){
  if(!controls) return;

  const speed = 10 * delta;
  direction.set(0,0,0);
  if(keys['KeyW']) direction.z -= 1;
  if(keys['KeyS']) direction.z += 1;
  if(keys['KeyA']) direction.x -= 1;
  if(keys['KeyD']) direction.x += 1;

  direction.normalize();
  velocity.lerp(direction.multiplyScalar(speed), 0.2); // friction
  controls.moveRight(velocity.x);
  controls.moveForward(velocity.z);
}

// ----- Animate -----
const clock = new THREE.Clock();

function animate(){
  requestAnimationFrame(animate);
  const delta = clock.getDelta();
  moveControls(delta);
  renderer.render(scene,camera);
}
animate();

// ----- Resize -----
window.addEventListener('resize', ()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
